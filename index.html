<!DOCTYPE html>
<html lang="en" >
<head >
    <meta charset="UTF-8" >
    <meta name="viewport" content="width=device-width, initial-scale=1" >
    <title ></title >
    <style type="text/css" >
        @font-face {
            font-family: 'AANeon';
            src: url('data/AA-Neon.ttf') format("truetype");
        }

        html, body, #canvas {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
            overflow: hidden;
        }

        #assets {
            width: 0px;
            height: 0px;
            overflow: hidden;
        }
    </style >
</head >
<body >
<div id="assets" >
    <span style="font: 48px 'AANeon';" >Text asset initialization</span >
    <canvas id="asset_factory" width="1920" height="1080" ></canvas >
</div >
<audio id="sound">
    <source type="audio/mp3" src="data/sound.mp3" >
</audio >
<canvas id="canvas" width="1920" height="1080" ></canvas >
</body >
<script type="text/javascript" src="node_modules/Color/Color.js" ></script >
<script type="text/javascript" src="node_modules/Pixels/Pixels.js" ></script >
<script type="text/javascript" src="node_modules/ConvexText/ConvexText.js" ></script >
<script type="text/javascript" src="soundEffect.js" ></script >
<script type="text/javascript" src="assetfactory.js" ></script >
<script type="text/javascript" >

    // TODO add sparkles with light paths for animation

    const sound = new SoundEffect('sound', 5);
    sound.onChange = (value, ratio) => {
        console.log('VALUE:', ratio);
    };
    let assetFactory;
    const bgImg = new Image();
    bgImg.src = 'data/background.jpg';
    bgImg.addEventListener('load', () => {
        assetFactory = new AssetCanvas('asset_factory', bgImg, (context) => {
            _text(context, 120, 500, -(Math.PI / 180) * 10);
        });
        setTimeout(() => {
            const canvas = document.getElementById('canvas');
            const cnx = canvas.getContext('2d');
            assetFactory.compose().then((image) => {
                // use source-in to make lightened wall
                cnx.filter = 'brightness(7.5%)';
                cnx.drawImage(bgImg, 0, 0);
                cnx.filter = 'none';
                cnx.drawImage(image, 0, 0);
            });
            sound.play();
        }, 500);
    });

    const _text = (cnx, x, y, angle) => {
        cnx.fillStyle = '#F433FF';
        cnx.font = '92px "AANeon"';
        cnx.rotate(angle);
        cnx.fillText("Я_ВСЕГДА_ХОТЕЛ_БЫТЬ", x + 60, y);
        cnx.font = '220px "AANeon"';
        cnx.fillText("  КРИПАЧEМ", x, y + 220);
        cnx.rotate(-angle);
    }
</script >
</html >
